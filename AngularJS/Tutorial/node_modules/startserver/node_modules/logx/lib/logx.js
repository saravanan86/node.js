/* ================================================================
 * logx by xdf(xudafeng[at]126.com)
 *
 * first created at : Thu Jun 19 2014 10:54:16 GMT+0800 (CST)
 *
 * ================================================================
 * Copyright 2014 xdf
 *
 * Licensed under the MIT License
 * You may not use this file except in compliance with the License.
 *
 * ================================================================ */

"use strict";

var util = require('util');
var color = require('colorx');

var types = ['debug', 'info', 'warn', 'error'];
var colors = ['gray', 'blue', 'yellow', 'red'];
var logx = {};
var t;
var isDebug = new RegExp('^\s*--debug\s*$');

process.argv.forEach(function(item) {
  if(isDebug.test(item)) t = 0;
})

function printf(i, msg) {
  var _t = typeof t === 'undefined' ? i : t;
  console.log(('<<' + types[_t].toUpperCase() + '>> : ' + msg)[colors[_t]]);
  if (_t === 3) throw new Error(msg);
}

function combine(arg) {
  var c = '';
  for(var i in arg) {
    c += typeof arg[i] === 'object'
      ? '\n' + util.inspect(arg[i], {depth: null })
      : arg[i];
  }
  return c;
}

types.forEach(function(v, k) {
  logx[v] = function() {
    var msg = combine(arguments);
    printf(k, msg);
  }
});

module.exports = logx;
